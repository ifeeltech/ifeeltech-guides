<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  {% seo %}
  
  {% if page.canonical_url %}
  <link rel="canonical" href="{{ page.canonical_url }}">
  {% endif %}
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  <meta property="og:title" content="{{ page.title }} | iFeeltech Guides">
  <meta property="og:description" content="{{ page.description | default: site.description }}">
  {% if page.featured_image %}
  <meta property="og:image" content="{{ page.featured_image }}">
  {% endif %}
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="{{ page.url | absolute_url }}">
  <meta property="twitter:title" content="{{ page.title }} | iFeeltech Guides">
  <meta property="twitter:description" content="{{ page.description | default: site.description }}">
  {% if page.featured_image %}
  <meta property="twitter:image" content="{{ page.featured_image }}">
  {% endif %}
  
  <!-- Schema.org markup -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "{{ page.title }}",
    "description": "{{ page.description | default: site.description }}",
    "author": {
      "@type": "Organization",
      "name": "iFeeltech",
      "url": "https://ifeeltech.com"
    },
    "publisher": {
      "@type": "Organization",
      "name": "iFeeltech",
      "url": "https://ifeeltech.com"
    },
    "datePublished": "{{ page.date | date_to_xmlschema }}",
    "dateModified": "{{ page.date | date_to_xmlschema }}",
    {% if page.featured_image %}
    "image": "{{ page.featured_image }}",
    {% endif %}
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ page.url | absolute_url }}"
    }
  }
  </script>
  
  <link rel="stylesheet" href="{{ '/assets/style.css' | relative_url }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Reading Progress Bar -->
  <div class="reading-progress" id="reading-progress"></div>
  
  <header>
    <div class="header-container">
      <nav>
        <a href="{{ '/' | relative_url }}" class="logo">
          <span class="logo-text">iFeeltech Guides</span>
        </a>
        <a href="https://ifeeltech.com" class="nav-link">Main Site</a>
      </nav>
    </div>
  </header>
  
  <main class="content">
    {% if page.featured_image %}
    <div class="featured-image">
      <img src="{{ page.featured_image }}" alt="{{ page.title }}" loading="lazy">
      {% if page.image_credit %}
      <p class="image-credit">Photo: {{ page.image_credit }}</p>
      {% endif %}
    </div>
    {% endif %}
    
    <article>
      <h1>{{ page.title }}</h1>
      {% if page.date %}
      <div class="meta">
        <span class="date">{{ page.date | date: "%B %d, %Y" }}</span>
        <span class="reading-time">{{ content | number_of_words | divided_by: 200 }} min read</span>
        {% if page.tags %}
        <div class="tags">
          {% for tag in page.tags %}
          <span class="tag">#{{ tag }}</span>
          {% endfor %}
        </div>
        {% endif %}
      </div>
      {% endif %}
      
      <!-- Table of Contents (will be populated by JavaScript) -->
      <aside class="table-of-contents" id="table-of-contents">
        <h4>On This Page</h4>
        <ul id="toc-list"></ul>
      </aside>
      
      <div class="article-content">
        {{ content }}
      </div>
    </article>
    
    <!-- Related Articles -->
    {% if page.layout == 'default' and page.date %}
    <aside class="related-articles">
      <h3>Related Articles</h3>
      <div class="related-articles-grid">
        {% assign related_posts = site.posts | where_exp: "post", "post.url != page.url" | sample: 3 %}
        {% for post in related_posts limit:3 %}
        <div class="related-article-card">
          <h4><a href="{{ post.url | relative_url }}">{{ post.title }}</a></h4>
          <p>{{ post.description | truncate: 100 }}</p>
        </div>
        {% endfor %}
      </div>
    </aside>
    {% endif %}
    
    {% if page.layout == 'default' and page.date %}
    <aside class="related-cta">
      <h3>Need Expert Guidance?</h3>
      <p>Our team at iFeeltech specializes in practical cybersecurity solutions for small and medium businesses.</p>
      <a href="https://ifeeltech.com/contact" class="cta-button">Get in Touch</a>
    </aside>
    {% endif %}
  </main>
  
  <footer>
    <div class="footer-container">
      <p>© {{ "now" | date: "%Y" }} iFeeltech — <a href="https://ifeeltech.com">ifeeltech.com</a></p>
      <p class="footer-tagline">Practical IT solutions for growing businesses</p>
    </div>
  </footer>
  
  <script>
    // Reading Progress Bar
    function updateReadingProgress() {
      const progressBar = document.getElementById('reading-progress');
      if (!progressBar) return;
      
      const windowHeight = window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight - windowHeight;
      const scrolled = window.scrollY;
      const progress = (scrolled / documentHeight) * 100;
      
      progressBar.style.width = progress + '%';
    }
    
    // Table of Contents Generation
    function generateTableOfContents() {
      const toc = document.getElementById('table-of-contents');
      const tocList = document.getElementById('toc-list');
      const articleContent = document.querySelector('.article-content');
      
      if (!toc || !tocList || !articleContent) return;
      
      const headings = articleContent.querySelectorAll('h2, h3');
      
      if (headings.length === 0) {
        toc.style.display = 'none';
        return;
      }
      
      headings.forEach((heading, index) => {
        // Add ID to heading if it doesn't have one
        if (!heading.id) {
          heading.id = 'heading-' + index;
        }
        
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = '#' + heading.id;
        a.textContent = heading.textContent;
        a.style.paddingLeft = heading.tagName === 'H3' ? '1.5rem' : '0.75rem';
        
        a.addEventListener('click', (e) => {
          e.preventDefault();
          heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
          history.pushState(null, null, '#' + heading.id);
        });
        
        li.appendChild(a);
        tocList.appendChild(li);
      });
    }
    
    // Highlight active TOC item on scroll
    function highlightActiveTocItem() {
      const headings = document.querySelectorAll('.article-content h2, .article-content h3');
      const tocLinks = document.querySelectorAll('.table-of-contents a');
      
      if (headings.length === 0 || tocLinks.length === 0) return;
      
      let currentActive = null;
      
      headings.forEach((heading) => {
        const rect = heading.getBoundingClientRect();
        if (rect.top <= 150 && rect.top >= -50) {
          currentActive = heading.id;
        }
      });
      
      tocLinks.forEach((link) => {
        link.classList.remove('active');
        if (currentActive && link.getAttribute('href') === '#' + currentActive) {
          link.classList.add('active');
        }
      });
    }
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      generateTableOfContents();
      updateReadingProgress();
      highlightActiveTocItem();
    });
    
    // Update on scroll
    let scrollTimeout;
    window.addEventListener('scroll', function() {
      updateReadingProgress();
      
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(highlightActiveTocItem, 50);
    });
  </script>
</body>
</html>
